<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buscador de Pel√≠culas - TheMovieDB</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .search-box {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin-bottom: 30px;
        }

        .search-form {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        input[type="text"] {
            flex: 1;
            padding: 15px 20px;
            font-size: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            outline: none;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus {
            border-color: #667eea;
        }

        button {
            padding: 15px 40px;
            font-size: 16px;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .options {
            display: flex;
            gap: 20px;
            align-items: center;
            font-size: 14px;
            color: #666;
        }

        .options label {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }

        .results-info {
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: none;
        }

        .results-info.show {
            display: block;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 25px;
        }

        .movie-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }

        .movie-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
        }

        .movie-poster {
            width: 100%;
            height: 375px;
            object-fit: cover;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .movie-info {
            padding: 15px;
        }

        .movie-title {
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .movie-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
        }

        .movie-rating {
            display: flex;
            align-items: center;
            gap: 4px;
            font-weight: bold;
            color: #f39c12;
        }

        .movie-overview {
            font-size: 0.85em;
            color: #666;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: white;
            font-size: 1.2em;
        }

        .error {
            background: #e74c3c;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }

        .no-poster {
            width: 100%;
            height: 375px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 3em;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2em;
            }

            .search-form {
                flex-direction: column;
            }

            .results-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 15px;
            }

            .movie-poster,
            .no-poster {
                height: 225px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üé¨ Buscador de Pel√≠culas</h1>
            <p class="subtitle">Encuentra tu pel√≠cula favorita usando TheMovieDB</p>
        </header>

        <div class="search-box">
            <form class="search-form" id="searchForm">
                <input 
                    type="text" 
                    id="searchInput" 
                    placeholder="Escribe el t√≠tulo de una pel√≠cula..." 
                    required
                    autocomplete="off"
                >
                <button type="submit" id="searchButton">Buscar</button>
            </form>
            <div class="options">
                <label>
                    <input type="checkbox" id="includeAdult">
                    Incluir contenido adulto
                </label>
                <label>
                    Idioma:
                    <select id="language">
                        <option value="es-MX">Espa√±ol (MX)</option>
                        <option value="es-ES">Espa√±ol (ES)</option>
                        <option value="en-US">English (US)</option>
                    </select>
                </label>
            </div>
        </div>

        <div id="error" class="error" style="display: none;"></div>
        
        <div id="resultsInfo" class="results-info">
            <strong>Resultados:</strong> <span id="totalResults">0</span> pel√≠culas encontradas
            (P√°gina <span id="currentPage">1</span> de <span id="totalPages">1</span>)
        </div>

        <div id="loading" class="loading" style="display: none;">
            <p>üîç Buscando pel√≠culas...</p>
        </div>

        <div id="results" class="results-grid"></div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8000';
        const TMDB_IMAGE_BASE = 'https://image.tmdb.org/t/p/w500';

        const searchForm = document.getElementById('searchForm');
        const searchInput = document.getElementById('searchInput');
        const searchButton = document.getElementById('searchButton');
        const includeAdultCheckbox = document.getElementById('includeAdult');
        const languageSelect = document.getElementById('language');
        const resultsDiv = document.getElementById('results');
        const loadingDiv = document.getElementById('loading');
        const errorDiv = document.getElementById('error');
        const resultsInfo = document.getElementById('resultsInfo');
        const totalResults = document.getElementById('totalResults');
        const currentPage = document.getElementById('currentPage');
        const totalPages = document.getElementById('totalPages');

        searchForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const query = searchInput.value.trim();
            if (query) {
                await searchMovies(query);
            }
        });

        async function searchMovies(query, page = 1) {
            // Mostrar loading
            loadingDiv.style.display = 'block';
            resultsDiv.innerHTML = '';
            errorDiv.style.display = 'none';
            resultsInfo.classList.remove('show');
            searchButton.disabled = true;

            try {
                const params = new URLSearchParams({
                    query: query,
                    page: page,
                    language: languageSelect.value,
                    include_adult: includeAdultCheckbox.checked
                });

                const response = await fetch(`${API_BASE_URL}/search/movie?${params}`);
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || 'Error al buscar pel√≠culas');
                }

                const data = await response.json();
                displayResults(data);

            } catch (error) {
                showError(error.message);
            } finally {
                loadingDiv.style.display = 'none';
                searchButton.disabled = false;
            }
        }

        function displayResults(data) {
            resultsDiv.innerHTML = '';

            if (data.results.length === 0) {
                resultsDiv.innerHTML = '<div class="error">No se encontraron pel√≠culas. Intenta con otro t√≠tulo.</div>';
                return;
            }

            // Actualizar informaci√≥n de resultados
            totalResults.textContent = data.total_results;
            currentPage.textContent = data.page;
            totalPages.textContent = data.total_pages;
            resultsInfo.classList.add('show');

            data.results.forEach(movie => {
                const movieCard = createMovieCard(movie);
                resultsDiv.appendChild(movieCard);
            });
        }

        function createMovieCard(movie) {
            const card = document.createElement('div');
            card.className = 'movie-card';

            const posterUrl = movie.poster_path 
                ? `${TMDB_IMAGE_BASE}${movie.poster_path}` 
                : null;

            const year = movie.release_date ? movie.release_date.split('-')[0] : 'N/A';
            const rating = movie.vote_average ? movie.vote_average.toFixed(1) : 'N/A';

            card.innerHTML = `
                ${posterUrl 
                    ? `<img src="${posterUrl}" alt="${movie.title}" class="movie-poster">` 
                    : `<div class="no-poster">üé¨</div>`
                }
                <div class="movie-info">
                    <div class="movie-title">${movie.title}</div>
                    <div class="movie-meta">
                        <span class="movie-year">${year}</span>
                        <span class="movie-rating">‚≠ê ${rating}</span>
                    </div>
                    ${movie.overview 
                        ? `<div class="movie-overview">${movie.overview}</div>` 
                        : '<div class="movie-overview">Sin descripci√≥n disponible.</div>'
                    }
                </div>
            `;

            return card;
        }

        function showError(message) {
            errorDiv.textContent = `‚ùå Error: ${message}`;
            errorDiv.style.display = 'block';
            
            // Si es un error de conexi√≥n, mostrar ayuda adicional
            if (message.includes('Failed to fetch') || message.includes('NetworkError')) {
                errorDiv.innerHTML = `
                    <strong>‚ùå Error de conexi√≥n</strong><br>
                    No se puede conectar a la API. Aseg√∫rate de que:<br>
                    1. La API est√© corriendo en http://localhost:8000<br>
                    2. Hayas configurado tu TMDB_API_KEY en el archivo .env<br>
                    3. Ejecutes: <code>python main.py</code>
                `;
            }
        }

        // Verificar estado de la API al cargar la p√°gina
        window.addEventListener('load', async () => {
            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                const data = await response.json();
                
                if (!data.api_key_configured) {
                    showError('La API key de TheMovieDB no est√° configurada. Revisa el archivo .env');
                }
            } catch (error) {
                showError('No se puede conectar a la API. Aseg√∫rate de que est√© corriendo en http://localhost:8000');
            }
        });
    </script>
</body>
</html>
